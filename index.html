<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pakistan Salary Tax Calculator (FY 2025–26 / TY 2026)</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e5e7eb;
      --blue:#0a66c2;
      --blue2:#0b5cad;
      --soft:#f1f5f9;
      --soft2:#eef2ff;
      --good:#16a34a;
      --warn:#f59e0b;
      --shadow: 0 10px 30px rgba(2, 6, 23, 0.08);
      --radius:14px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      background:var(--bg);
      color:var(--text);
      padding:22px;
    }

    .container{max-width:1040px;margin:0 auto}

    .header{
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between;
      margin-bottom:14px;
      flex-wrap:wrap;
    }
    .title{
      font-size:28px; font-weight:800; letter-spacing:-0.02em; margin:0;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px;
      background:var(--soft2);
      border:1px solid #dbeafe;
      color:#1e40af;
      border-radius:999px;
      font-size:12px;
      font-weight:700;
      height: fit-content;
    }

    .subnote{
      margin:0 0 18px 0;
      color:var(--muted);
      line-height:1.5;
      font-size:13px;
    }
    .subnote b{color:var(--text)}

    .grid{
      display:grid;
      gap:14px;
    }

    /* Mobile: 1 col, Tablet: 2 col, Desktop: 3 col */
    .grid.form{
      grid-template-columns: 1fr;
    }
    @media(min-width:720px){
      .grid.form{ grid-template-columns: 1fr 1fr; }
    }
    @media(min-width:980px){
      .grid.form{ grid-template-columns: 1.1fr 1fr 1fr; }
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
    }
    .card .inner{ padding:16px; }
    .card h3{
      margin:0 0 10px 0;
      font-size:14px;
      letter-spacing:0.02em;
      color:#0b1220;
      text-transform: none;
    }

    .field label{
      display:block;
      font-size:12px;
      color:#0b1220;
      font-weight:700;
      margin-bottom:6px;
    }
    .hint{font-size:12px;color:var(--muted);margin-top:6px}

    input, select{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#fff;
      font-size:14px;
      outline:none;
    }
    input:focus, select:focus{
      border-color:#93c5fd;
      box-shadow:0 0 0 4px rgba(59,130,246,0.12);
    }

    .actions{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
      margin-top:12px;
    }
    .btn{
      width:100%;
      border:none;
      border-radius:12px;
      padding:12px 14px;
      font-weight:800;
      font-size:14px;
      cursor:pointer;
      background:var(--blue);
      color:#fff;
      transition:0.15s ease;
    }
    .btn:hover{ background:var(--blue2); }
    @media(min-width:720px){
      .btn{ width:auto; min-width:220px; }
    }

    .kpis{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:8px;
    }
    @media(min-width:720px){
      .kpis{ grid-template-columns: 1fr 1fr; }
    }

    .kpi{
      background:var(--soft);
      border:1px solid #e2e8f0;
      border-radius:12px;
      padding:12px;
    }
    .kpi .label{font-size:12px;color:var(--muted);font-weight:700;margin-bottom:6px}
    .kpi .value{font-size:18px;font-weight:900;letter-spacing:-0.02em}

    .row{
      display:flex; gap:10px; align-items:flex-start; justify-content:space-between;
      flex-wrap:wrap;
      padding:10px 0;
      border-bottom:1px dashed #e2e8f0;
    }
    .row:last-child{border-bottom:none}
    .row .left{color:var(--muted);font-size:13px;font-weight:700}
    .row .right{font-size:13px;font-weight:800}

    .pill{
      display:inline-flex; align-items:center;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:800;
      border:1px solid var(--border);
      background:#fff;
      color:#0b1220;
    }
    .pill.good{ background:#ecfdf5; border-color:#bbf7d0; color:#065f46; }
    .pill.warn{ background:#fffbeb; border-color:#fde68a; color:#92400e; }

    /* Tables */
    .tableWrap{
      overflow:auto;
      border:1px solid var(--border);
      border-radius:12px;
      background:#fff;
    }
    table{
      width:100%;
      border-collapse:collapse;
      min-width:720px; /* allows horizontal scroll on mobile */
    }
    th, td{
      padding:10px 12px;
      border-bottom:1px solid #eef2f7;
      text-align:left;
      font-size:13px;
      white-space:nowrap;
    }
    th{
      background:#f8fafc;
      font-size:12px;
      color:#0b1220;
      letter-spacing:0.02em;
      text-transform: none;
      position:sticky;
      top:0;
      z-index:1;
    }
    .trApplied{
      background:#eef2ff;
    }
    .rightAlign{ text-align:right; }

    .footerNote{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      line-height:1.5;
    }

    .twoCol{
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }
    @media(min-width:980px){
      .twoCol{ grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 class="title">Pakistan Salary Tax Calculator</h1>
      <div class="badge">FY 2025–26 / Tax Year 2026</div>
    </div>

    <p class="subnote">
      Uses <b>FBR Salary (Section 149) slab rates</b>. Supports partial months using day-based fractions.
      This is a <b>simplified estimator</b> (no exemptions/allowances/rebates/other income).
    </p>

    <!-- FORM -->
    <div class="card">
      <div class="inner">
        <div class="grid form">
          <div class="field">
            <label>Monthly Salary (PKR)</label>
            <input id="monthlySalary" type="number" placeholder="e.g., 250000" />
            <div class="hint">Enter monthly taxable salary (simplified).</div>
          </div>

          <div class="field">
            <label>Start Date (Joining within tax year)</label>
            <input id="startDate" type="date" />
            <div class="hint">If blank, assumes 2025-07-01</div>
          </div>

          <div class="field">
            <label>End Date (Leaving within tax year) — optional</label>
            <input id="endDate" type="date" />
            <div class="hint">If blank, assumes 2026-06-30</div>
          </div>

          <div class="field">
            <label>Tax Deduction Method</label>
            <select id="method">
              <option value="average">Method A: Average tax per effective month (fraction-based)</option>
              <option value="payroll">Method B: Payroll-style (spread across remaining months in FY)</option>
            </select>
            <div class="hint">Payroll method spreads total tax across remaining FY months.</div>
          </div>

          <div class="field">
            <label>Tax Year Range (fixed)</label>
            <input type="text" value="01-Jul-2025 to 30-Jun-2026" disabled />
            <div class="hint">Fixed for this calculator version.</div>
          </div>

          <div class="field">
            <label>Prorate payroll tax in partial month</label>
            <select id="payrollProrate">
              <option value="no">No (deduct full month tax in partial month)</option>
              <option value="yes">Yes (deduct tax proportional to month fraction)</option>
            </select>
            <div class="hint">Different companies handle partial month differently.</div>
          </div>
        </div>

        <div class="actions">
          <button class="btn" id="calcBtn">Calculate</button>
        </div>
      </div>
    </div>

    <!-- RESULTS + SLABS -->
    <div class="twoCol" style="margin-top:14px;">
      <div class="card">
        <div class="inner">
          <h3>Results</h3>

          <div class="kpis">
            <div class="kpi">
              <div class="label">Taxable Income (approx)</div>
              <div class="value" id="kpiIncome">—</div>
            </div>
            <div class="kpi">
              <div class="label">Estimated Total Tax</div>
              <div class="value" id="kpiTax">—</div>
            </div>
          </div>

          <div style="margin-top:10px;">
            <div class="row">
              <div class="left">Period</div>
              <div class="right" id="rPeriod">—</div>
            </div>
            <div class="row">
              <div class="left">Effective Months (income basis)</div>
              <div class="right" id="rEffMonths">—</div>
            </div>
            <div class="row">
              <div class="left">Method</div>
              <div class="right" id="rMethod">—</div>
            </div>
            <div class="row">
              <div class="left">Applied Slab</div>
              <div class="right" id="rSlab">—</div>
            </div>
            <div class="row">
              <div class="left">Slab Calculation</div>
              <div class="right" id="rSlabMath">—</div>
            </div>
          </div>

          <div class="footerNote" id="noteBlock">
            Notes: simplified estimator; surcharge applies if taxable income exceeds 10,000,000; exemptions/allowances/rebates not included.
          </div>
        </div>
      </div>

      <div class="card">
        <div class="inner">
          <h3>Salary Slabs Used (TY 2026)</h3>
          <div class="tableWrap" id="slabTableWrap">
            <table id="slabTable">
              <thead>
                <tr>
                  <th>Range (PKR)</th>
                  <th class="rightAlign">Fixed Tax</th>
                  <th class="rightAlign">Marginal Rate</th>
                  <th>Formula</th>
                </tr>
              </thead>
              <tbody id="slabTbody"></tbody>
            </table>
          </div>
          <div class="footerNote">
            Highlight shows the slab applied to your taxable income.
          </div>
        </div>
      </div>
    </div>

    <!-- MONTHLY SCHEDULE -->
    <div class="card" style="margin-top:14px;">
      <div class="inner">
        <h3>Monthly Schedule</h3>
        <div class="footerNote" style="margin-top:-4px;">
          Income uses day-based fractions. Tax depends on selected method. Table scrolls on mobile.
        </div>
        <div class="tableWrap" style="margin-top:10px;">
          <table>
            <thead>
              <tr>
                <th>Month</th>
                <th class="rightAlign">Income Fraction</th>
                <th class="rightAlign">Income (approx)</th>
                <th class="rightAlign">Tax Deducted</th>
                <th class="rightAlign">Cumulative Tax</th>
              </tr>
            </thead>
            <tbody id="scheduleTbody">
              <tr><td colspan="5" style="color:#64748b;">Run a calculation to see the schedule.</td></tr>
            </tbody>
          </table>
        </div>
        <div class="footerNote">
          Payroll method: spreads total tax over remaining FY months from your start month (to June).
        </div>
      </div>
    </div>

  </div>

  <script>
    // -------------------------
    // Date utilities (local-safe)
    // -------------------------
    function parseLocalInputDate(value) {
      if (!value) return null;
      const parts = value.split("-");
      if (parts.length !== 3) return null;
      const y = Number(parts[0]);
      const m = Number(parts[1]);
      const d = Number(parts[2]);
      if (!y || !m || !d) return null;
      const dt = new Date(y, m - 1, d, 0, 0, 0, 0);
      return isNaN(dt.getTime()) ? null : dt;
    }

    function formatDateSafe(d) {
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${y}-${m}-${day}`;
    }

    function clampDate(d, min, max) {
      return new Date(Math.min(Math.max(d.getTime(), min.getTime()), max.getTime()));
    }

    function daysInMonth(year, monthIndex0) {
      return new Date(year, monthIndex0 + 1, 0).getDate();
    }

    function monthName(m0) {
      return ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][m0];
    }

    function formatPKR(n) {
      return (Math.round(n)).toLocaleString("en-PK");
    }

    // -------------------------
    // Salary slabs (TY 2026) — for display + applied slab identification
    // -------------------------
    // Each slab: lowerExclusive, upperInclusive, fixedTax, rate, baseForRate
    const SLABS_TY2026 = [
      { id: 1, label: "Up to 600,000",         lo: 0,        hi: 600000,   fixed: 0,      rate: 0.00, base: 0,
        formula: "0" },
      { id: 2, label: "600,001 – 1,200,000",   lo: 600000,   hi: 1200000,  fixed: 0,      rate: 0.01, base: 600000,
        formula: "1% of (Income − 600,000)" },
      { id: 3, label: "1,200,001 – 2,200,000", lo: 1200000,  hi: 2200000,  fixed: 6000,   rate: 0.11, base: 1200000,
        formula: "6,000 + 11% of (Income − 1,200,000)" },
      { id: 4, label: "2,200,001 – 3,200,000", lo: 2200000,  hi: 3200000,  fixed: 116000, rate: 0.23, base: 2200000,
        formula: "116,000 + 23% of (Income − 2,200,000)" },
      { id: 5, label: "3,200,001 – 4,100,000", lo: 3200000,  hi: 4100000,  fixed: 346000, rate: 0.30, base: 3200000,
        formula: "346,000 + 30% of (Income − 3,200,000)" },
      { id: 6, label: "Above 4,100,000",       lo: 4100000,  hi: Infinity, fixed: 616000, rate: 0.35, base: 4100000,
        formula: "616,000 + 35% of (Income − 4,100,000)" },
    ];

    function getAppliedSlab(income) {
      // income is taxable annual
      for (const s of SLABS_TY2026) {
        if (income > s.lo && income <= s.hi) return s;
        if (s.hi === Infinity && income > s.lo) return s;
        if (income <= 600000) return SLABS_TY2026[0];
      }
      return SLABS_TY2026[0];
    }

    function salaryTaxTY2026(income) {
      const slab = getAppliedSlab(income);
      let tax = 0;

      if (slab.id === 1) tax = 0;
      else tax = slab.fixed + (income - slab.base) * slab.rate;

      // Surcharge @ 9% if income exceeds 10,000,000
      if (income > 10000000) tax = tax + (tax * 0.09);

      return { tax, slab, surchargeApplied: income > 10000000 };
    }

    // -------------------------
    // Monthly fractions (day-based)
    // -------------------------
    function computeMonthlyFractions(startDate, endDate) {
      const rows = [];
      let cur = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
      const endMonthStart = new Date(endDate.getFullYear(), endDate.getMonth(), 1);

      let total = 0;

      while (cur.getTime() <= endMonthStart.getTime()) {
        const y = cur.getFullYear();
        const m = cur.getMonth();
        const dim = daysInMonth(y, m);

        const monthStart = new Date(y, m, 1);
        const monthEnd = new Date(y, m, dim);

        const activeStart = new Date(Math.max(monthStart.getTime(), startDate.getTime()));
        const activeEnd = new Date(Math.min(monthEnd.getTime(), endDate.getTime()));

        let fraction = 0;
        if (activeStart.getTime() <= activeEnd.getTime()) {
          const daysWorked = Math.floor((activeEnd - activeStart) / (1000*60*60*24)) + 1;
          fraction = daysWorked / dim;
        }

        total += fraction;
        rows.push({ y, m, dim, fraction });

        cur = new Date(y, m + 1, 1);
      }

      return { total, rows };
    }

    // Count remaining months in FY from the start month to FY end inclusive
    function countRemainingMonthsInFY(startDate, fyEnd) {
      const startM = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
      const endM = new Date(fyEnd.getFullYear(), fyEnd.getMonth(), 1);
      let count = 0;
      let cur = new Date(startM);
      while (cur.getTime() <= endM.getTime()) {
        count++;
        cur = new Date(cur.getFullYear(), cur.getMonth() + 1, 1);
      }
      return count;
    }

    function renderSlabTable(appliedSlabId) {
      const tbody = document.getElementById("slabTbody");
      tbody.innerHTML = "";

      for (const s of SLABS_TY2026) {
        const tr = document.createElement("tr");
        if (s.id === appliedSlabId) tr.className = "trApplied";

        const range = s.hi === Infinity
          ? `> ${formatPKR(s.lo)}`
          : `${formatPKR(s.lo + 1)} – ${formatPKR(s.hi)}`;

        tr.innerHTML = `
          <td>${s.label}<div style="color:#64748b;font-size:12px;margin-top:4px;">(${range})</div></td>
          <td class="rightAlign">PKR ${formatPKR(s.fixed)}</td>
          <td class="rightAlign">${Math.round(s.rate*100)}%</td>
          <td>${s.formula}</td>
        `;
        tbody.appendChild(tr);
      }
    }

    function setText(id, text){ document.getElementById(id).textContent = text; }
    function setHTML(id, html){ document.getElementById(id).innerHTML = html; }

    // -------------------------
    // Main
    // -------------------------
    document.getElementById("calcBtn").addEventListener("click", () => {
      const salary = Number(document.getElementById("monthlySalary").value);
      const method = document.getElementById("method").value;
      const payrollProrate = document.getElementById("payrollProrate").value === "yes";

      if (!salary || salary <= 0) {
        alert("Please enter a valid monthly salary.");
        return;
      }

      // FY 2025-26: 01-Jul-2025 to 30-Jun-2026 (LOCAL dates)
      const fyStart = new Date(2025, 6, 1);
      const fyEnd = new Date(2026, 5, 30);

      const rawStart = parseLocalInputDate(document.getElementById("startDate").value) || fyStart;
      const rawEnd = parseLocalInputDate(document.getElementById("endDate").value) || fyEnd;

      // normalize and clamp
      const s0 = rawStart.getTime() <= rawEnd.getTime() ? rawStart : rawEnd;
      const e0 = rawStart.getTime() <= rawEnd.getTime() ? rawEnd : rawStart;

      const start = clampDate(s0, fyStart, fyEnd);
      const end = clampDate(e0, fyStart, fyEnd);

      const { total: effectiveMonths, rows } = computeMonthlyFractions(start, end);
      const taxableIncome = salary * effectiveMonths;

      const taxResult = salaryTaxTY2026(taxableIncome);
      const totalTax = taxResult.tax;
      const appliedSlab = taxResult.slab;

      // Slab math display
      let slabMath = "";
      if (appliedSlab.id === 1) {
        slabMath = `No tax (≤ PKR 600,000).`;
      } else {
        const marginalBase = taxableIncome - appliedSlab.base;
        const marginalTax = marginalBase * appliedSlab.rate;
        slabMath = `PKR ${formatPKR(appliedSlab.fixed)} + ${Math.round(appliedSlab.rate*100)}% × (PKR ${formatPKR(taxableIncome)} − PKR ${formatPKR(appliedSlab.base)})
                    = PKR ${formatPKR(appliedSlab.fixed)} + PKR ${formatPKR(marginalTax)}
                    = PKR ${formatPKR(appliedSlab.fixed + marginalTax)}`;
        if (taxResult.surchargeApplied) {
          slabMath += ` + 9% surcharge`;
        }
      }

      // Allocation denominator
      let denom = effectiveMonths; // average method
      if (method === "payroll") denom = countRemainingMonthsInFY(start, fyEnd);

      const taxPerUnit = denom > 0 ? (totalTax / denom) : 0;

      // Build schedule
      let cumulativeTax = 0;
      const schedule = rows.map(r => {
        const income = salary * r.fraction;

        let taxThisMonth = 0;
        if (method === "average") {
          taxThisMonth = taxPerUnit * r.fraction;
        } else {
          // payroll method: full month tax, optionally prorated
          taxThisMonth = payrollProrate ? (taxPerUnit * r.fraction) : taxPerUnit;
        }

        cumulativeTax += taxThisMonth;

        return {
          label: `${monthName(r.m)}-${String(r.y).slice(-2)}`,
          fraction: r.fraction,
          income,
          tax: taxThisMonth,
          cumulative: cumulativeTax
        };
      });

      // Render results
      setText("kpiIncome", `PKR ${formatPKR(taxableIncome)}`);
      setText("kpiTax", `PKR ${formatPKR(totalTax)}`);

      setText("rPeriod", `${formatDateSafe(start)} to ${formatDateSafe(end)}`);
      setText("rEffMonths", effectiveMonths.toFixed(4));

      const methodLabel =
        method === "average"
          ? "Method A: Average (fraction-based)"
          : `Method B: Payroll-style (remaining FY months)${payrollProrate ? " — prorated partial month" : ""}`;

      setText("rMethod", methodLabel);
      setHTML("rSlab", `${appliedSlab.label}`);
      setHTML("rSlabMath", slabMath);

      // Notes
      const surchargePill = taxResult.surchargeApplied
        ? `<span class="pill warn">9% Surcharge Applied</span>`
        : `<span class="pill good">No Surcharge</span>`;
      setHTML("noteBlock",
        `Notes: simplified estimator; exemptions/allowances/rebates not included. ${surchargePill}`
      );

      // Render slab table + highlight applied
      renderSlabTable(appliedSlab.id);

      // Render schedule table
      const tbody = document.getElementById("scheduleTbody");
      tbody.innerHTML = "";
      for (const s of schedule) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${s.label}</td>
          <td class="rightAlign">${s.fraction.toFixed(4)}</td>
          <td class="rightAlign">PKR ${formatPKR(s.income)}</td>
          <td class="rightAlign">PKR ${formatPKR(s.tax)}</td>
          <td class="rightAlign">PKR ${formatPKR(s.cumulative)}</td>
        `;
        tbody.appendChild(tr);
      }
    });

    // Initial slab table render (no highlight)
    renderSlabTable(-1);
  </script>
</body>
</html>
